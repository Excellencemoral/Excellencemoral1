<!DOCTYPE html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>react demo</title>
  <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>
</head>

<body>
  <style>
    html,
    body {
      margin: 0;
      height: 100%;
      font-family: sans-serif;
    }

    main {
      padding: 16px;
    }

    .reactContainerComponent {
      padding: 8px;
      border: 1px dashed tomato;
      background: lightblue;
    }
  </style>
  <main>
    <div id="root"></div>
  </main>
  <script type="module">
    import 'react/umd/react.development.js';
    import 'react-dom/umd/react-dom.development.js';
    import { LitElement, html, css } from 'lit-element';
    import {createElement} from '../development/frameworks/react/createElement.js';
    import {createComponent} from '../development/frameworks/react/createComponent.js';

    window.createElement = createElement;
    window.createComponent = createComponent;

    class MyElement extends LitElement {

      static properties = {
        foo: {},
        bar: {reflect: true},
        data: {},
        onzug: {event: 'zug'}
      }

      static styles = css`
        :host {
          display: block;
          border: 1px dashed tomato;
          background: beige;
          padding: 8px;
        }
      `;

      constructor() {
        super();
        this.foo = 'foo';
        this.bar = 'bar';
        this.data = {};
        this.addEventListener('click', () => {
          this.dispatchEvent(new Event('zug', {bubbles: true, composed: true}));
        })
      }

      render() {
        return html`
          <h4>${this.localName} with props:</h4>
          <ul>
            <li>foo: ${this.foo}</li>
            <li>bar: ${this.bar}</li>
            <li>data: <pre style="display: inline">${JSON.stringify(this.data)}</pre></li>
          </ul>
          <h4>and content:</h4>
          <slot></slot>
        `;
      }

    }

    customElements.define('my-element', MyElement);

    class RawElement extends HTMLElement {
      constructor() {
        super();
        this.attachShadow({mode: 'open'});
        this.addEventListener('click', () => {
          this.dispatchEvent(new Event('zug', {bubbles: true, composed: true}));
        })
        this.update();
      }

      update() {
        this.shadowRoot.innerHTML = `<style>:host {
          display: block;
          border: 1px dashed tomato;
          background: beige;
          padding: 8px;
        }</style><h4>${this.localName} with props:</h4>
          <ul>
            <li>foo: ${this.foo}</li>
            <li>bar: ${this.bar}</li>
            <li>data: <pre style="display: inline">${JSON.stringify(this.data)}</pre></li>
          </ul>
          <h4>and content:</h4>
          <slot></slot>`;
      }

      get foo() {
        return this._foo;
      }

      set foo(value) {
        this._foo = value;
         this.update();
      }

      get bar() {
        return this._bar;
      }

      set bar(value) {
        this._bar = value;
         this.update();
      }

      get data() {
        return this._data;
      }

      set data(value) {
        this._data = value;
         this.update();
      }
    }

    customElements.define('raw-element', RawElement);
  </script>
  <script type="text/babel">

    const createElement = createElement(React);

    const RawElementComponent = createComponent(React, 'raw-element',
      {
        properties: { reactFoo: 'foo', reactBar: 'bar', reactData: 'data'},
        events: {onZug: 'zug'}
      });

    // React component that uses a custom element as a component.
    class Container extends React.Component {

      state = {count: 0, data: {name: 'Bob', count: 0}}

      myElement = React.createRef();

      render() {
        const zugListener = (e) => {
          const count = ++this.state.count;
          this.setState({
            count,
            data: {
              name: 'Bob',
              count
            }
          })
        };

        /** @jsx createElement */
        return <div className="reactContainerComponent">
          <h3>React container with custom element components</h3>
          <h4>LitElement oobe: works!</h4>
          <my-element
            elementRef={this.myElement}
            foo={`react-foo: ${this.state.count}`}
            bar={`react-bar: ${this.state.count}`}
            data={this.state.data}
            onzug={zugListener}>
            MyElement content
          </my-element>
          <hr />
          <h4>Raw Element oobe: no events or property mapping</h4>
          <raw-element
            elementRef={this.myElement}
            foo={`react-foo: ${this.state.count}`}
            bar={`react-bar: ${this.state.count}`}
            data={this.state.data}
            onzug={zugListener}>
            MyElement content
          </raw-element>
          <hr />
          <h4>Raw Element Component oobe: events and property mapping</h4>
          <RawElementComponent
            elementRef={this.myElement}
            reactFoo={`react-foo: ${this.state.count}`}
            reactBar={`react-bar: ${this.state.count}`}
            reactData={this.state.data}
            onZug={zugListener}>
            MyElement content
          </RawElementComponent>
        </div>
      }

      componentDidUpdate() {
        console.log(this.myElement);
      }

    }

    window.ReactDOM.render(createElement(Container, {}, null), root);

  </script>
</body>

</html>