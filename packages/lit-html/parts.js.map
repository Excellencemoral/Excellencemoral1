{"version":3,"file":"parts.js","sources":["src/parts.ts"],"sourcesContent":["import {NodePart, nothing} from './lit-html.js';\n\n/**\n * The state of a NodePart, which can be detached and reattached.\n */\nexport type NodePartState = {};\n\n/**\n * The private interface for NodePartState, which should be kept opaque.\n */\ntype NodePartStateInternal = {\n  __value: unknown;\n  __fragment: DocumentFragment;\n};\n\nexport const detachNodePart = (part: NodePart): NodePartState => {\n  const fragment = document.createDocumentFragment();\n  const state: NodePartStateInternal = {\n    __value: part.__value,\n    __fragment: fragment,\n  };\n  let start = part.__startNode.nextSibling;\n  let nextNode;\n  while (start !== part.__endNode) {\n    nextNode = start!.nextSibling;\n    fragment.append(start!);\n    start = nextNode;\n  }\n  part.__value = nothing;\n  return state;\n};\n\nexport const restoreNodePart = (part: NodePart, state: NodePartState) => {\n  // TODO (justinfagnani): make an interal-only interface\n  (part as any).__commitNode((state as NodePartStateInternal).__fragment);\n  part.__value = (state as NodePartStateInternal).__value;\n};\n\nconst createMarker = () => document.createComment('');\n\nexport const createAndInsertPart = (\n  containerPart: NodePart,\n  refPart?: NodePart\n): NodePart => {\n  const container = containerPart.__startNode.parentNode as Node;\n\n  const endNode =\n    refPart === undefined ? containerPart.__endNode : refPart.__startNode;\n\n  const startNode = container.insertBefore(createMarker(), endNode);\n\n  container.insertBefore(createMarker(), endNode);\n  const newPart = new NodePart(startNode, endNode, containerPart.options);\n  return newPart;\n};\n\nexport const updatePart = (part: NodePart, value: unknown) => {\n  part.__setValue(value);\n  return part;\n};\n\nexport const insertPartBefore = (\n  containerPart: NodePart,\n  part: NodePart,\n  refPart?: NodePart\n) => {\n  const container = containerPart.__startNode.parentNode!;\n\n  const refNode = refPart ? refPart.__startNode : containerPart.__endNode;\n\n  const endNode = part.__endNode!.nextSibling;\n\n  if (endNode !== refNode) {\n    // assertNodeMakers(part);\n    reparentNodes(container, part.__startNode, endNode, refNode);\n  }\n};\n\nexport const removePart = (part: NodePart) => {\n  removeNodes(\n    part.__startNode,\n    part.__endNode!.nextSibling\n  );\n};\n\n/**\n * Reparents nodes, starting from `start` (inclusive) to `end` (exclusive),\n * into another container (could be the same container), before `before`. If\n * `before` is null, it appends the nodes to the container.\n */\nexport const reparentNodes = (\n  container: Node,\n  start: Node | null,\n  end: Node | null = null,\n  before: Node | null = null\n): void => {\n  while (start !== end) {\n    const n = start!.nextSibling;\n    container.insertBefore(start!, before);\n    start = n;\n  }\n};\n\n/**\n * Removes nodes, starting from `start` (inclusive) to `end` (exclusive), from\n * `container`.\n */\nexport const removeNodes = (\n  start: ChildNode | null,\n  end: ChildNode | null = null\n): void => {\n  while (start !== end) {\n    const n = start!.nextSibling;\n    start!.remove();\n    start = n;\n  }\n};\n"],"names":["detachNodePart","part","fragment","document","createDocumentFragment","state","t","__value","o","nextNode","start","__startNode","nextSibling","__endNode","append","nothing","restoreNodePart","__commitNode","__fragment","createMarker","createComment","createAndInsertPart","containerPart","refPart","container","parentNode","endNode","undefined","startNode","insertBefore","NodePart","options","updatePart","value","__setValue","insertPartBefore","refNode","reparentNodes","removePart","removeNodes","end","before","n","remove"],"mappings":"4DAeaA,EAAkBC,IAC7B,MAAMC,EAAWC,SAASC,yBACpBC,EAA+B,CACnCC,EAASL,EAAKM,EACdC,GAEF,IACIC,EADAC,EAAQT,EAAKU,EAAYC,YAE7B,KAAOF,IAAUT,EAAKY,GACpBJ,EAAWC,EAAOE,YAClBV,EAASY,OAAOJ,GAChBA,EAAQD,EAGV,OADAR,EAAKM,EAAUQ,EACRV,GAGIW,EAAkB,CAACf,EAAgBI,KAE7CJ,EAAagB,EAAcZ,EAAgCa,GAC5DjB,EAAKM,EAAWF,EAAgCE,GAG5CY,EAAe,IAAMhB,SAASiB,cAAc,IAErCC,EAAsB,CACjCC,EACAC,KAEA,MAAMC,EAAYF,EAAcX,EAAYc,WAEtCC,OACQC,IAAZJ,EAAwBD,EAAcT,EAAYU,EAAQZ,EAEtDiB,EAAYJ,EAAUK,aAAaV,IAAgBO,GAIzD,OAFAF,EAAUK,aAAaV,IAAgBO,GACvB,IAAII,EAASF,EAAWF,EAASJ,EAAcS,UAIpDC,EAAa,CAAC/B,EAAgBgC,KACzChC,EAAKiC,EAAWD,GACThC,GAGIkC,EAAmB,CAC9Bb,EACArB,EACAsB,KAEA,MAAMC,EAAYF,EAAcX,EAAYc,WAEtCW,EAAUb,EAAUA,EAAQZ,EAAcW,EAAcT,EAExDa,EAAUzB,EAAKY,EAAWD,YAE5Bc,IAAYU,GAEdC,EAAcb,EAAWvB,EAAKU,EAAae,EAASU,IAI3CE,EAAcrC,IACzBsC,EACEtC,EAAKU,EACLV,EAAKY,EAAWD,cASPyB,EAAgB,CAC3Bb,EACAd,EACA8B,EAAmB,KACnBC,EAAsB,QAEtB,KAAO/B,IAAU8B,GAAK,CACpB,MAAME,EAAIhC,EAAOE,YACjBY,EAAUK,aAAanB,EAAQ+B,GAC/B/B,EAAQgC,IAQCH,EAAc,CACzB7B,EACA8B,EAAwB,QAExB,KAAO9B,IAAU8B,GAAK,CACpB,MAAME,EAAIhC,EAAOE,YACjBF,EAAOiC,SACPjC,EAAQgC"}