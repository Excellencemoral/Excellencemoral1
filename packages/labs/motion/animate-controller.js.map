{"version":3,"file":"animate-controller.js","sources":["src/animate-controller.ts"],"sourcesContent":["import {ReactiveControllerHost} from 'lit';\nimport {Animate, AnimateOptions} from './animate.js';\n\nexport const animateControllers: WeakMap<\n  ReactiveControllerHost,\n  AnimateController\n> = new WeakMap();\n\n/**\n * AnimateController can be used to provide default configuration options to all\n * `animate()` directives in a given component.\n *\n * It also provides control over all the `animate()` animations within a given\n * component, for example, `this.animateController.pause()` pauses all animations.\n */\nexport class AnimateController {\n  host: ReactiveControllerHost;\n  animateOptions: AnimateOptions;\n  startPaused = false;\n  disabled = false;\n  onComplete?: () => void;\n\n  constructor(\n    host: ReactiveControllerHost,\n    info: {\n      animateOptions?: AnimateOptions;\n      startPaused?: boolean;\n      disabled?: boolean;\n      onComplete?: () => void;\n    }\n  ) {\n    this.host = host;\n    this.animateOptions = info.animateOptions || {};\n    this.startPaused = !!info.startPaused;\n    this.disabled = !!info.disabled;\n    this.onComplete = info.onComplete;\n    animateControllers.set(this.host, this);\n  }\n\n  /**\n   * Set of active `animate()` in the host component\n   */\n  animates: Set<Animate> = new Set();\n\n  protected pendingComplete = false;\n\n  async add(animate: Animate) {\n    this.animates.add(animate);\n    if (this.startPaused) {\n      animate.animation?.pause();\n    }\n    this.pendingComplete = true;\n    await animate.finished;\n    if (this.pendingComplete && !this.isAnimating) {\n      this.pendingComplete = false;\n      this.onComplete?.();\n    }\n  }\n\n  remove(animate: Animate) {\n    this.animates.delete(animate);\n  }\n\n  /**\n   * Pauses all `animate()` animations running in the host component.\n   */\n  pause() {\n    this.animates.forEach((f) => f.animation?.pause());\n  }\n\n  /**\n   * Plays all active `animate()` animations in the host component.\n   */\n  play() {\n    this.animates.forEach((f) => f.animation?.play());\n  }\n\n  cancel() {\n    this.animates.forEach((f) => f.animation?.cancel());\n    this.animates.clear();\n  }\n\n  finish() {\n    this.animates.forEach((f) => f.animation?.finish());\n    this.animates.clear();\n  }\n\n  /**\n   * Toggles the play/pause state of all active `animate()` animations in the host component.\n   */\n  togglePlay() {\n    if (this.isPlaying) {\n      this.pause();\n    } else {\n      this.play();\n    }\n  }\n\n  /**\n   * Returns true if the host component has any active `animate()` animations.\n   */\n  get isAnimating() {\n    return this.animates.size > 0;\n  }\n\n  /**\n   * Returns true if the host component has any playing `animate()` animations.\n   */\n  get isPlaying() {\n    return Array.from(this.animates).some(\n      (a) => a.animation?.playState === 'running'\n    );\n  }\n\n  async finished() {\n    await Promise.all(Array.from(this.animates).map((f) => f.finished));\n  }\n}\n"],"names":["animateControllers","WeakMap","AnimateController","constructor","host","info","this","Set","animateOptions","startPaused","disabled","onComplete","set","add","animate","animates","animation","pause","pendingComplete","finished","isAnimating","remove","delete","forEach","f","play","cancel","clear","finish","togglePlay","isPlaying","size","Array","from","some","a","playState","Promise","all","map"],"mappings":"MAGaA,EAGT,IAAIC,cASKC,EAOXC,YACEC,EACAC,GANFC,kBAAc,EACdA,eAAW,EAuBXA,cAAyB,IAAIC,IAEnBD,sBAAkB,EAb1BA,KAAKF,KAAOA,EACZE,KAAKE,eAAiBH,EAAKG,gBAAkB,GAC7CF,KAAKG,cAAgBJ,EAAKI,YAC1BH,KAAKI,WAAaL,EAAKK,SACvBJ,KAAKK,WAAaN,EAAKM,WACvBX,EAAmBY,IAAIN,KAAKF,KAAME,MAUpCO,UAAUC,WACRR,KAAKS,SAASF,IAAIC,GACdR,KAAKG,wBACPK,EAAQE,0BAAWC,SAErBX,KAAKY,iBAAkB,QACjBJ,EAAQK,SACVb,KAAKY,kBAAoBZ,KAAKc,cAChCd,KAAKY,iBAAkB,YACvBZ,KAAKK,gCAALL,OAIJe,OAAOP,GACLR,KAAKS,SAASO,OAAOR,GAMvBG,QACEX,KAAKS,SAASQ,SAASC,UAAM,iBAAAA,EAAER,gCAAWC,WAM5CQ,OACEnB,KAAKS,SAASQ,SAASC,UAAM,iBAAAA,EAAER,gCAAWS,UAG5CC,SACEpB,KAAKS,SAASQ,SAASC,UAAM,iBAAAA,EAAER,gCAAWU,YAC1CpB,KAAKS,SAASY,QAGhBC,SACEtB,KAAKS,SAASQ,SAASC,UAAM,iBAAAA,EAAER,gCAAWY,YAC1CtB,KAAKS,SAASY,QAMhBE,aACMvB,KAAKwB,UACPxB,KAAKW,QAELX,KAAKmB,OAOTL,kBACE,OAAOd,KAAKS,SAASgB,KAAO,EAM9BD,gBACE,OAAOE,MAAMC,KAAK3B,KAAKS,UAAUmB,MAC9BC,UAAM,MAA2B,uBAA3BA,EAAEnB,gCAAWoB,cAIxBjB,uBACQkB,QAAQC,IAAIN,MAAMC,KAAK3B,KAAKS,UAAUwB,KAAKf,GAAMA,EAAEL"}